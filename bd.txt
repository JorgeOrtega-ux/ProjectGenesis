-- Base de datos: project_genesis
-- (Según config.php)

-- --- Tabla de Usuarios ---
-- Esta tabla almacena la información principal del usuario.
DROP TABLE IF EXISTS users;

CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    email VARCHAR(255) NOT NULL UNIQUE,
    username VARCHAR(255) NOT NULL UNIQUE,
    -- Almacena la contraseña hasheada (ej. PASSWORD_BCRYPT)
    password VARCHAR(255) NOT NULL,
    profile_image_url VARCHAR(255) NULL,
    -- El ENUM se basa en los roles de styles.css y auth_handler.php
    `role` ENUM('user', 'moderator', 'administrator', 'founder') NOT NULL DEFAULT 'user',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL
);


-- --- Tabla de Códigos de Verificación ---
-- Almacena códigos temporales para registro, reseteo de contraseña, etc.
DROP TABLE IF EXISTS verification_codes;

CREATE TABLE verification_codes (
    id INT AUTO_INCREMENT PRIMARY KEY,
    -- 'identifier' guarda el email (para registro/reset)
    identifier VARCHAR(255) NOT NULL, 
    -- 'code_type' define el propósito del código
    code_type ENUM('registration', 'password_reset') NOT NULL,
    code VARCHAR(255) NOT NULL,
    -- 'payload' guarda datos extra (ej. username, password_hash) como JSON
    payload TEXT, 
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    -- Índice para búsquedas rápidas de códigos
    INDEX idx_identifier_type (identifier, code_type)
);